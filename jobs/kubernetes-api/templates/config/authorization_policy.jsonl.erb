<%=

p("users").map do |user|
  policy = {
    "apiVersion" => "abac.authorization.kubernetes.io/v1beta1",
    "kind"       => "Policy",
    "spec"       => {
      "user"            => user['username'],
      "namespace"       => "*",
      "resource"        => "*",
      "apiGroup"        => "*",
      "nonResourcePath" => "*"
    }
  }
  policy.to_json
end.join("\n")

%>
{"apiVersion": "abac.authorization.kubernetes.io/v1beta1", "kind": "Policy", "spec": {"user":"kubelet", "namespace": "*", "resource": "*", "apiGroup": "*"}}
{"apiVersion": "abac.authorization.kubernetes.io/v1beta1", "kind": "Policy", "spec": {"group":"system:serviceaccounts", "namespace": "*", "resource": "*", "apiGroup": "*", "nonResourcePath": "*"}}