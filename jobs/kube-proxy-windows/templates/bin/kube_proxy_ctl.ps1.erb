$ErrorActionPreference = "Stop";
trap { $host.SetShouldExit(1) }

<% if_p('cloud-provider') do |cloud_provider| %>
  $cloud_provider="<%= cloud_provider %>"
<% end %>

function Get-HostnameOverride
{
    if ("gce" -eq $cloud_provider) {
        return "$(hostname)"
    } else {
        return "<%= spec.ip %>"
    }
}

$network = Get-HnsNetwork | ? Type -Eq Overlay
$env:KUBE_NETWORK = $network.Name


C:\var\vcap\packages\kubernetes-windows\bin\kube-proxy.exe `
  --config /var/vcap/jobs/kube-proxy-windows/config/config.yml `
  --v=<%= p('logging-level') %> `
  --hostname-override=$(Get-HostnameOverride)
