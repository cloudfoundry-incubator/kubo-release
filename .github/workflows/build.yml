name: build

on:
  push:
    branches: [ gh-actions-build ]

jobs:
  build:
    container: 
      image: gcr.io/cf-pks-golf/pcfkubo/kubo-ci
    runs-on: ubuntu-latest
    steps:
    - name: Checkout kubo-release
      uses: actions/checkout@v2
    - name: Build release
      run: .github/tasks/build.sh
    - id: upload-file
      uses: google-github-actions/upload-cloud-storage@main
      with:
        credentials: ${{ secrets.GCS_SA_CI }}
        path: .
        destination: github-dev-releases
        glob: 'kubo-release-*.tgz'
    - name: generate-compilation-manifest
      run: .github/tasks/generate-compilation-manifest.sh
      env:
          RELEASE_LIST: kubo
    - name: output-manifest
      run: cat manifest.yml
    # - name: compile-releases
    #   run: ./github/tasks/compile-releases.sh
    #   env:
    #       file: ${{steps.upload-file.outputs.uploaded}}